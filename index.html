<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Video Compressor</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <!-- Upload zone -->
    <div class="dropzone" id="dropzone">
      <div class="icon">☁️⬆️</div>
      <div class="title">Upload Your Video</div>
      <button type="button">Browse Files</button>
      <input type="file" id="videoFile" accept=".mp4,.mov">
    </div>

    <!-- Quality cards -->
    <div class="quality-group">
      <h3>Select Compression Quality</h3>
      <div class="cards">
        <div class="card selected" data-quality="high"><h4>High Quality</h4></div>
        <div class="card" data-quality="medium"><h4>Medium Quality</h4></div>
      </div>
    </div>

    <!-- Compress button -->
    <button class="compress-btn" id="compressBtn">Compress Video</button>

    <!-- Progress bar -->
    <div class="progress-container">
      <div class="progress-label">Progress</div>
      <div class="progress-bar">
        <div id="progressFill" class="progress-fill"></div>
      </div>
    </div>
  </div>

  <script>
    const { ipcRenderer } = require('electron');
    const dz           = document.getElementById('dropzone');
    const fileInput    = document.getElementById('videoFile');
    const cards        = document.querySelectorAll('.card');
    const compressBtn  = document.getElementById('compressBtn');
    const progressFill = document.getElementById('progressFill');

    // Drag & drop
    dz.addEventListener('dragover', e => { e.preventDefault(); dz.classList.add('hover'); });
    dz.addEventListener('dragleave', () => dz.classList.remove('hover'));
    dz.addEventListener('drop', e => {
      e.preventDefault();
      dz.classList.remove('hover');
      if (e.dataTransfer.files.length) fileInput.files = e.dataTransfer.files;
    });
    dz.querySelector('button').addEventListener('click', () => fileInput.click());

    // Card select
    cards.forEach(c => c.addEventListener('click', () => {
      cards.forEach(x => x.classList.remove('selected'));
      c.classList.add('selected');
    }));

    // Receive progress events
    ipcRenderer.on('ffmpeg-progress', (e, pct) => {
      progressFill.style.width = pct + '%';
    });

    // Compress click
    compressBtn.addEventListener('click', async () => {
      if (!fileInput.files.length) {
        return alert('❌ Please select an MP4 or MOV file.');
      }
      const file = fileInput.files[0];
      if (!file.path) {
        return alert('❌ Cannot access file path. Drag‑and‑drop or re‑browse the file.');
      }
      const quality = document.querySelector('.card.selected').dataset.quality;
      progressFill.style.width = '0%';
      try {
        const output = await ipcRenderer.invoke('compress-video', {
          filePath: file.path,
          quality
        });
        alert('✅ Done! Saved to:\n' + output);
      } catch (err) {
        alert('❌ Error: ' + err);
      }
    });
  </script>
</body>
</html>
