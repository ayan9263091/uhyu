<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Video Compressor</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>Video Compressor</h1>
  <!-- Dropzone for file upload -->
  <div id="dropzone">Drag & Drop Video Here or Click to Select</div>
  <input type="file" id="fileInput" accept="video/*" hidden>

  <!-- Quality selector -->
  <label for="quality">Quality:</label>
  <select id="quality">
    <option value="high">High</option>
    <option value="medium">Medium</option>
  </select>
  <button id="compressBtn">Compress</button>

  <!-- Progress bar -->
  <div>
    <progress id="progressBar" value="0" max="100"></progress>
    <span id="progressText">0%</span>
  </div>

  <script>
    // Get DOM elements
    const dropzone = document.getElementById('dropzone');
    const fileInput = document.getElementById('fileInput');
    const qualitySelect = document.getElementById('quality');
    const compressBtn = document.getElementById('compressBtn');
    const progressBar = document.getElementById('progressBar');
    const progressText = document.getElementById('progressText');

    let selectedFilePath = null;

    // Highlight dropzone on drag over
    dropzone.addEventListener('dragover', (e) => {
      e.preventDefault();
      dropzone.classList.add('dragover');
    });
    dropzone.addEventListener('dragleave', () => {
      dropzone.classList.remove('dragover');
    });

    // Handle file drop
    dropzone.addEventListener('drop', (e) => {
      e.preventDefault();
      dropzone.classList.remove('dragover');
      if (e.dataTransfer.files && e.dataTransfer.files[0]) {
        handleFile(e.dataTransfer.files[0]);
      }
    });

    // Click on dropzone to open file dialog
    dropzone.addEventListener('click', () => fileInput.click());

    // Handle file selection via input
    fileInput.addEventListener('change', (e) => {
      if (e.target.files && e.target.files[0]) {
        handleFile(e.target.files[0]);
      }
    });

    // Store selected file path
    function handleFile(file) {
      // In Electron, File objects have a `path` property (native path)
      if (file.path) {
        selectedFilePath = file.path;
        dropzone.textContent = `Selected: ${file.name}`;
      } else {
        alert('Unable to get file path.');
      }
    }

    // On clicking Compress, send IPC to main process
    compressBtn.addEventListener('click', () => {
      if (!selectedFilePath) {
        alert('Please select a video file first.');
        return;
      }
      const quality = qualitySelect.value; // 'high' or 'medium'
      // Reset progress UI
      progressBar.value = 0;
      progressText.textContent = '0%';
      // Send path and quality to main process
      window.electronAPI.startCompression(selectedFilePath, quality);
    });

    // Receive progress updates from main process
    window.electronAPI.onProgress((percent) => {
      progressBar.value = percent;
      progressText.textContent = `${percent}%`;
    });

    // Receive completion notification from main process
    window.electronAPI.onCompleted((outputPath) => {
      alert('Compression complete!\nOutput saved to:\n' + outputPath);
    });
  </script>
</body>
</html>
