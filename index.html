<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Video Compressor</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>üé• Video Compressor</h1>

  <!-- Dropzone -->
  <div id="dropzone">Drag & Drop Video Here<br>or Click to Select</div>
  <input type="file" id="fileInput" accept=".mp4,.mov" hidden>

  <!-- Quality selector -->
  <label for="quality">Quality:</label>
  <select id="quality">
    <option value="high">High</option>
    <option value="medium">Medium</option>
  </select>
  <button id="compressBtn">Compress</button>

  <!-- Progress -->
  <div class="progress-wrapper">
    <progress id="progressBar" value="0" max="100"></progress>
    <span id="progressText">0%</span>
  </div>

  <script>
    const dropzone = document.getElementById('dropzone');
    const fileInput = document.getElementById('fileInput');
    const quality = document.getElementById('quality');
    const compressBtn = document.getElementById('compressBtn');
    const progressBar = document.getElementById('progressBar');
    const progressText = document.getElementById('progressText');
    let selectedPath = null;

    // Drag/drop handlers
    dropzone.addEventListener('dragover', e => {
      e.preventDefault();
      dropzone.classList.add('hover');
    });
    dropzone.addEventListener('dragleave', () => {
      dropzone.classList.remove('hover');
    });
    dropzone.addEventListener('drop', e => {
      e.preventDefault();
      dropzone.classList.remove('hover');
      handleFile(e.dataTransfer.files[0]);
    });

    // Click to open dialog
    dropzone.addEventListener('click', () => fileInput.click());
    fileInput.addEventListener('change', e => handleFile(e.target.files[0]));

    function handleFile(file) {
      if (file && file.path) {
        selectedPath = file.path;
        dropzone.innerHTML = `Selected:<br>${file.name}`;
      } else {
        alert('Cannot access file path. Please drag‚Äëand‚Äëdrop or reselect.');
      }
    }

    // Start compression
    compressBtn.addEventListener('click', () => {
      if (!selectedPath) {
        alert('Please select a video file first.');
        return;
      }
      progressBar.value = 0;
      progressText.textContent = '0%';
      window.electronAPI.startCompression(selectedPath, quality.value);
    });

    // Update progress
    window.electronAPI.onProgress(pct => {
      progressBar.value = pct;
      progressText.textContent = pct + '%';
    });

    // Done!
    window.electronAPI.onCompleted(out => {
      if (out.startsWith('Error')) {
        alert('‚ùå ' + out);
      } else {
        alert('‚úÖ Compression complete!\nOutput saved to:\n' + out);
      }
    });
  </script>
</body>
</html>
